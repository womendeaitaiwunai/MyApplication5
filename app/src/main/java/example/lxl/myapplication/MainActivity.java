package example.lxl.myapplication;

import android.app.Activity;
import android.content.Intent;
import android.graphics.Color;
import android.graphics.drawable.Drawable;
import android.os.Bundle;
import android.support.v4.app.Fragment;
import android.support.v4.app.FragmentManager;
import android.support.v4.app.FragmentTransaction;
import android.support.v4.content.ContextCompat;
import android.support.v7.app.ActionBar;
import android.view.LayoutInflater;
import android.view.View;
import android.support.design.widget.NavigationView;
import android.support.v4.view.GravityCompat;
import android.support.v4.widget.DrawerLayout;
import android.support.v7.widget.Toolbar;
import android.view.MenuItem;
import android.widget.TextView;
import android.widget.Toast;

import com.nightonke.boommenu.BoomMenuButton;
import com.nightonke.boommenu.Types.BoomType;
import com.nightonke.boommenu.Types.ButtonType;
import com.nightonke.boommenu.Types.PlaceType;
import com.nightonke.boommenu.Util;
import com.zys.brokenview.BrokenTouchListener;
import com.zys.brokenview.BrokenView;

import java.util.Random;

import example.lxl.myapplication.activity.AnalIDCardNoActivity;
import example.lxl.myapplication.activity.SimulationCodeActivity;
import example.lxl.myapplication.base.BaseActivity;
import example.lxl.myapplication.util.anima.ShapeRevealLoopSample;
import example.lxl.myapplication.util.chicken.ChickenActivity;
import su.levenetc.android.textsurface.TextSurface;

public class MainActivity extends BaseActivity
        implements NavigationView.OnNavigationItemSelectedListener {

    private BoomMenuButton boomMenuButton,boomMenuButtonInfo;
    private boolean isInit = false;//boomMenuButton是否初始化完成
    private View mCustomView;
    private BrokenView brokenView;
    private BrokenTouchListener listener;
    private TextSurface textSurface;


    private FragmentManager fragmentManager;

    @Override
    protected void onCreate(Bundle savedInstanceState) {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

        final DrawerLayout drawer = (DrawerLayout) findViewById(R.id.drawer_layout);
        drawer.setBackgroundResource(R.mipmap.body_bg);
        findViewById(R.id.hide).setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                drawer.closeDrawer(GravityCompat.START);
            }
        });

        findViewById(R.id.show).setOnClickListener(new View.OnClickListener() {
            @Override
            public void onClick(View v) {
                drawer.openDrawer(GravityCompat.START);
            }
        });
        // ActionBarDrawerToggle toggle = new ActionBarDrawerToggle(
        //        this, drawer, toolbar, R.string.navigation_drawer_open, R.string.navigation_drawer_close);
        // drawer.addDrawerListener(toggle);
        //toggle.syncState();

        NavigationView navigationView = (NavigationView) findViewById(R.id.nav_view);
        navigationView.setNavigationItemSelectedListener(this);
        boomMenuButton= (BoomMenuButton) findViewById(R.id.boom);

        Toolbar toolbar= (Toolbar) findViewById(R.id.toolbar);
        setSupportActionBar(toolbar);
        ActionBar mActionBar = getSupportActionBar();
        mActionBar.setDisplayShowHomeEnabled(false);
        mActionBar.setDisplayShowTitleEnabled(false);
        LayoutInflater mInflater = LayoutInflater.from(this);

        mCustomView = mInflater.inflate(R.layout.custom_actionbar, null);
        TextView mTitleTextView = (TextView) mCustomView.findViewById(R.id.title_text);
        mTitleTextView.setText(R.string.app_name);

        boomMenuButtonInfo = (BoomMenuButton) mCustomView.findViewById(R.id.info);

        mActionBar.setCustomView(mCustomView);
        mActionBar.setDisplayShowCustomEnabled(true);

        ((Toolbar) mCustomView.getParent()).setContentInsetsAbsolute(0,0);

        brokenView = BrokenView.add2Window(MainActivity.this);
        listener = new BrokenTouchListener.Builder(brokenView).build();
        findViewById(R.id.click_screen).setOnTouchListener(listener);

        textSurface = (TextSurface) findViewById(R.id.text_surface);
        textSurface.postDelayed(new Runnable() {
            @Override public void run() {
                show();
            }
        }, 1000);

        fragmentManager=getSupportFragmentManager();
    }

    @Override
    protected Activity initActivity(Activity activity) {
        return this;
    }

    private void show() {
        textSurface.reset();
        ShapeRevealLoopSample.play(textSurface);
    }

    @Override
    public void onWindowFocusChanged(boolean hasFocus) {
        super.onWindowFocusChanged(hasFocus);
        if (!isInit) {
            initBoom();
        }
        isInit = true;
    }

    /**
     * 修改主页的界面
     * @param chaneFragment 要修改的界面
     */
    private void changMainView(Fragment chaneFragment){
        FragmentTransaction fragmentTransaction=fragmentManager.beginTransaction();
        fragmentTransaction.replace(R.id.main_change,chaneFragment);
        fragmentTransaction.commit();
    }


    /**
     * 初始化爆炸菜单的信息
     */
    private void initBoom() {
        int number = 3;

        Drawable[] drawables = new Drawable[number];
        int[] drawablesResource = new int[]{
                R.mipmap.heart,
                R.mipmap.like,
                R.mipmap.refresh
        };
        for (int i = 0; i < number; i++)
            drawables[i] = ContextCompat.getDrawable(MainActivity.this, drawablesResource[i]);

        String[] STRINGS = new String[]{
                "喜欢",
                "设置",
                "刷新"
        };
        String[] strings = new String[number];
        for (int i = 0; i < number; i++)
            strings[i] = STRINGS[i];

        int[][] colors = new int[number][2];
        for (int i = 0; i < number; i++) {
            colors[i][1] = GetRandomColor();
            colors[i][0] = Util.getInstance().getPressedColor(colors[i][1]);
        }

        ButtonType buttonType = ButtonType.CIRCLE;

        // Now with Builder, you can init BMB more convenient
        new BoomMenuButton.Builder()
                .subButtons(drawables, colors, strings)
                .button(buttonType)
                .boom(BoomType.LINE)
                .place(PlaceType.CIRCLE_3_1)
                .boomButtonShadow(Util.getInstance().dp2px(2), Util.getInstance().dp2px(2))
                .subButtonsShadow(Util.getInstance().dp2px(2), Util.getInstance().dp2px(2))
                .init(boomMenuButton);

        new BoomMenuButton.Builder()
                .subButtons(drawables, colors, new String[]{"点击喜欢", "点击设置", "点击刷新"})
                .button(ButtonType.HAM)
                .boom(BoomType.PARABOLA_2)
                .place(PlaceType.HAM_3_1)
                .subButtonsShadow(Util.getInstance().dp2px(2), Util.getInstance().dp2px(2))
                .subButtonTextColor(ContextCompat.getColor(MainActivity.this, R.color.black))
                .onSubButtonClick(new BoomMenuButton.OnSubButtonClickListener() {
                    @Override
                    public void onClick(int buttonIndex) {
                        if (buttonIndex == 0) {
                            Toast.makeText(MainActivity.this, "喜欢!", Toast.LENGTH_SHORT).show();
                        } else if (buttonIndex == 1) {
                            Toast.makeText(MainActivity.this, "设置!", Toast.LENGTH_SHORT).show();
                        } else if (buttonIndex == 2) {
                            Toast.makeText(MainActivity.this, "刷新!", Toast.LENGTH_SHORT).show();
                        }
                    }
                })
                .init(boomMenuButtonInfo);

    }

    private String[] Colors = {
            "#F44336",
            "#E91E63",
            "#9C27B0",
            "#2196F3",
            "#03A9F4",
            "#00BCD4",
            "#009688",
            "#4CAF50",
            "#8BC34A",
            "#CDDC39",
            "#FFEB3B",
            "#FFC107",
            "#FF9800",
            "#FF5722",
            "#795548",
            "#9E9E9E",
            "#607D8B"};

    public int GetRandomColor() {
        Random random = new Random();
        int p = random.nextInt(Colors.length);
        return Color.parseColor(Colors[p]);
    }


    @Override
    public void onBackPressed() {
        DrawerLayout drawer = (DrawerLayout) findViewById(R.id.drawer_layout);
        if (drawer.isDrawerOpen(GravityCompat.START)) {
            drawer.closeDrawer(GravityCompat.START);
        } else {
            super.onBackPressed();
        }
    }


    @Override
    public boolean onOptionsItemSelected(MenuItem item) {
        int id = item.getItemId();
        if (id == R.id.action_settings) {
            return true;
        }
        return super.onOptionsItemSelected(item);
    }

    /**
     * 菜单选择NavigationView的选择事件
     * @param item NavigationView的item
     */
    @SuppressWarnings("StatementWithEmptyBody")
    @Override
    public boolean onNavigationItemSelected(MenuItem item) {
        int id = item.getItemId();

        if (id == R.id.nav_camera) {
            //身份证扫描
            startActivity(new Intent(MainActivity.this,AnalIDCardNoActivity.class));
        } else if (id == R.id.nav_gallery) {
            //桌面小图标
            startActivity(new Intent(MainActivity.this,SimulationCodeActivity.class));
        } else if (id == R.id.nav_slideshow) {
            //肉鸡测试
            startActivity(new Intent(MainActivity.this,ChickenActivity.class));

        } else if (id == R.id.nav_manage) {

        } else if (id == R.id.nav_share) {

        } else if (id == R.id.nav_send) {

        }
        DrawerLayout drawer = (DrawerLayout) findViewById(R.id.drawer_layout);
        drawer.closeDrawer(GravityCompat.START);
        return true;
    }
}
